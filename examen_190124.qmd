---
title: "Examen final"
format: html
editor: visual
editor_options: 
  chunk_output_type: console
---

```{r}
### Chargement des données
library(tidyverse)
library(haven)
library(questionr)

enl <- readRDS(file = "data/enl_examen.RDS")
```

# Consignes

L'enquête nationale sur les conditions de logement est une enquête réalisée par l'INSEE tous les 5 ans. La base de données utilisées ici porte sur des **ménages résidant en France métropolitaine dans un logement ordinaire**. La variable `poids` est la variable de pondération.

L'examen dure 2 heures. Il faut écrire le code dans les espaces dédiés et rédiger vos commentaires et vos réponses **dans le corps du texte,** à l'endroit où il y a écrit "Réponse :".

Il est composé de 3 parties, notées sur un total de 36 points. Le temps indicatif est donné pour chaque sous-partie, comme pour le nombre de points de chaque exercice et questions d'exercice.

# Partie 1

## Questions de maîtrise du raisonnement statistique - 8 points - 20 minutes

### Question 1 - 2/8 points

La base de données de l'enquête nationale sur les conditions de logement est livrée avec une variable de pondération. En mobilisant les concepts d'échantillon et de représentativité statistique, expliquez avec vos propres mots quelle est l'utilité de cette variable. (3 phrases attendues)

Réponse :

### Question 2 - 2/8 points

Dans un test d'hypothèse utilisant la statistique du Khi2, expliquez avec vos propres mots ce que mesure la statistique du Khi2 et à quoi correspond l'hypothèse nulle. (3 phrases attendues)

Réponse :

### Question 3 - 2/8 points

Expliquez avec vos propres mots ce que mesure la p-valeur associée à un test du Khi2. (2 phrases attendues)

Réponse :

### Question 4 - 2/8 points

Dans le cadre de la transition écologique, le gouvernement souhaite savoir quelles catégories de population utilisent le plus l'avion. Il a pour cela réalisé une enquête dans l'ensemble des aéroports du territoire français. Pendant 1 semaine, des vols ont sélectionnés aléatoirement et toutes les personnes à bord ont été interrogées sur la fréquence à laquelle elles prenaient l'avion. Les résultats de l'enquête indiquent que les plus riches ne prennent pas significativement plus l'avion que le reste de la population. Faites-vous confiance à cette conclusion et pourquoi ? (2 phrases attendues)

Réponse :

# Partie 2

## Analyse de la surface des logements - 16 points - 1 heure

### Exercice 1 - 6 points

#### Recodage - 2/6 points

Créez une variable synthétique du statut d'occupation du logement, nommée `occup`, qui permettra de comparer **3 catégories** : les ménages propriétaires, les ménages locataires et les ménages locataires dans le secteur HLM (logement social). La nouvelle colonne doit être un facteur dont les modalités sont ordonnées comme ceci : locataire HLM, locataire, propriétaire. **Expliquez vos choix de recodage.**

Vous utiliserez les variables :

`SOC3`

| Valeur dans la base de données | Modalité                       |
|--------------------------------|--------------------------------|
| 2                              | Propriétaire                   |
| 3                              | Logé gratuitement : sans loyer |
| 4                              | Locataire et sous-locataire    |

`LSY1`

| Valeur dans la base de données | Modalité                                               |
|--------------------------------|--------------------------------------------------------|
| 1                              | Loyer soumis à la réglementation HLM (logement social) |
| 2                              | Loyer "libre"                                          |

```{r}

```

Réponse :

#### Calculs - 2/6 points

Calculez la surface d'habitation moyenne (variable `HSL1`) selon l'occupation du logement (`occup`).

```{r}

```

Réponse :

La variable `champrev2` correspond au champ des ménages dont on connaît le revenu annuel. Elle vaut `Oui` si le ménage a déclaré des revenus positifs auprès de l'administration fiscale, `Non` si les revenus déclarés étaient nuls ou négatifs. Il faut appliquer ce filtre dès que l'on utilise la variable `MRTOTA3` qui renseigne le revenu annuel du ménage.

Calculez à nouveau la surface d'habitation moyenne et calculez en plus le revenu annuel moyen selon l'occupation du logement.

```{r}

```

Sans vous préoccuper du changement des surfaces obtenues selon qu'on applique ou non le filtre du revenu : quelle analyse peut-on faire de ce rapport entre les revenus moyens, la surface et le statut d'occupation ?

Réponse :

#### Identification d'un biais - 2/6 points

Expliquez maintenant quel biais semble être introduit quand on applique le filtre du revenu vis-à-vis des moyennes des surfaces selon le statut d'occupation du logement, et donc les précautions à prendre pendant l'interprétation.

### Exercice 2 - 10 points

#### Recodage - 1/10 point

Créez une variable `rev1000` à partir de la variable de revenu `MRTOTA3` qui convertit le revenu annuel exprimé en euros en revenu exprimé en milliers d'euros.

```{r}

```

#### Construction du modèle de régression linéaire - 1/10 points

Construisez un modèle de régression avec la fonction `lm` qui modélise la surface du logement habité à partir du revenu exprimé en milliers d'euros (var `rev1000`), de l'occupation du logement (var `occup`) et du type de logement (var `typ_log` prenant deux valeurs : soit individuel comme pour le cas des maisons, soit collectif comme pour les appartements dans un immeuble). Utilisez la fonction `summary` pour avoir le résumé des résultats du modèle.

```{r}

```

#### Lecture du modèle de régression linéaire - 4/10 points

Voici ce que vous deviez obtenir :

![](images/reg_HSL1.png)

Rédigez un texte qui présente les résultats de ce modèle de régression. Expliquez pour au moins un coefficient à quoi correspond la p-value et ce qu'on en déduit.

Réponse :

#### Transformation du modèle - 2/10 points

Comment peut-on modifier modèle de régression de sorte qu'on puisse distinguer, pour chaque statut d'occupation du logement, l'effet du revenu sur la surface du logement ?

Réponse :

Transformez le modèle dans la formule fournie à la fonction `lm`

```{r}

```

#### Interprétation des résultats - 3/10 points

Voici ce que vous auriez dû obtenir :

![](images/reg_HSL1_int.png)

Décrivez les inégalités de logement en fonction du revenu à partir des résultats du modèle de régression, en respectant à nouveau les normes de lecture des coefficients.

Réponse :

# Partie 3

## Construction d'un nouvel indicateur et analyse - 20 minutes

### Exercice 1 - 6 points

#### Filtrage des données - 1/6 point

Soit `csp` la colonne qui renseigne la classe socio-professionnelle de la personne de référence du ménage. Les retraité·es ont été associé·es au dernier emploi occupé. Combien de modalités la variable `csp` présente-elle ?

```{r}

```

Réponse :

Créez un nouveau tableau de données `enl2` qui ne contient ni les ménages agriculteurs et inactifs, ni les ménages dont `csp` vaut `NA`, ni les ménages exclus du champ des revenus (`champrev2` valant "Oui").

```{r}

```

#### Création d'une variable - 1/6 point

Au sein de votre nouveau tableau de données, créez une variable `part_log` qui représente la part du revenu consacré aux dépenses de logement à partir de la variable de revenu `MRTOTA3` et du total net des dépenses de logement `cfn3`.

```{r}

```

#### Création d'une boîte à moustache 4/6 points

Créez une boîte à moustache qui représente en ordonnée la classe socio-professionnelle, en abscisse la part des dépenses de logement dans le revenu. **Ajoutez la ligne `lims(x = c(0, 0.5))`** à votre suite de code pour ne représenter que les parts comprises entre 0 et 0,5. Ajoutez tous les éléments attendus sur un graphique. Commentez et interprétez ensuite le graphique.

```{r}

```

Réponse :

## Construction et lecture d'un tableau croisé - 20 minutes

### Exercice 2 - 6 points

#### Construire le tableau croisé - 2/6 points

À partir du tableau de données filtré `enl2` (Partie 2 - Exercice 1 - 1), construisez un tableau croisé de la classe socio-professionnelle et de la variable `aut_log` qui compte le nombre d'autres logements possédés (= pas la résidence principale) par le ménage. Réalisez un test statistique adapté à ce tableau.

```{r}

```

#### Lecture du tableau croisé - 4/6 points

Voici ce que vous devriez obtenir :

![](images/tab_croise.png)

Lisez et interprétez rigoureusement ce tableau croisé en respectant les normes de lecture et de formulation vues en cours, en choisissant un nombre suffisant de cases pertinentes pour décrire la distribution sociale du patrimoine immobilier. N'oubliez pas de mentionner le test statistique.

Réponse :
